C51 COMPILER V9.01   MAIN                                                                  04/13/2021 19:35:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\Program_Soft\C51Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             红外通信实验                                                                                                *
   3          实现现象：下载程序后，数码管显示红外遥控键值数据
   4          注意事项：      红外遥控器内的电池绝缘片一定要抽掉                                                                                                                                                        
   5          ***************************************************************************************/
   6          
   7          #include "reg52.h"                       //此文件中定义了单片机的一些特殊功能寄存器
   8                  
   9          
  10          typedef unsigned int u16;         //对数据类型进行声明定义
  11          typedef unsigned char u8;
  12          
  13          sbit LSA=P2^2;
  14          sbit LSB=P2^3;
  15          sbit LSC=P2^4;
  16          
  17          sbit IRIN=P3^2;
  18          
  19          u8 IrValue[6];
  20          u8 Time;
  21          
  22          u8 DisplayData[8];
  23          u8 code smgduan[17]={
  24          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  25          0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71,0X76};
  26          //0、1、2、3、4、5、6、7、8、9、A、b、C、d、E、F、H的显示码
  27          
  28          /*******************************************************************************
  29          * 函 数 名         : delay
  30          * 函数功能                 : 延时函数，i=1时，大约延时10us
  31          *******************************************************************************/
  32          void delay(u16 i)
  33          {
  34   1              while(i--);     
  35   1      }
  36          
  37          
  38          /*******************************************************************************
  39          * 函数名         :DigDisplay()
  40          * 函数功能               :数码管显示函数
  41          * 输入           : 无
  42          * 输出           : 无
  43          *******************************************************************************/
  44          void DigDisplay()
  45          {
  46   1              u8 i;
  47   1              for(i=0;i<3;i++)
  48   1              {
  49   2                      switch(i)        //位选，选择点亮的数码管，
  50   2                      {
  51   3                              case(0):
  52   3                                      LSA=0;LSB=0;LSC=0; break;//显示第0位
  53   3                              case(1):
  54   3                                      LSA=1;LSB=0;LSC=0; break;//显示第1位
  55   3                              case(2):
C51 COMPILER V9.01   MAIN                                                                  04/13/2021 19:35:08 PAGE 2   

  56   3                                      LSA=0;LSB=1;LSC=0; break;//显示第2位    
  57   3                      }
  58   2                      P0=DisplayData[2-i];//发送数据
  59   2                      delay(100); //间隔一段时间扫描  
  60   2                      P0=0x00;//消隐
  61   2              }               
  62   1      }
  63          
  64          
  65          /*******************************************************************************
  66          * 函数名         : IrInit()
  67          * 函数功能                 : 初始化红外线接收
  68          * 输入           : 无
  69          * 输出           : 无
  70          *******************************************************************************/
  71          
  72          void IrInit()
  73          {
  74   1              IT0=1;//下降沿触发
  75   1              EX0=1;//打开中断0允许
  76   1              EA=1;   //打开总中断
  77   1      
  78   1              IRIN=1;//初始化端口
  79   1      }
  80          
  81          
  82          /*******************************************************************************
  83          * 函 数 名       : main
  84          * 函数功能               : 主函数
  85          * 输    入       : 无
  86          * 输    出       : 无
  87          *******************************************************************************/
  88          void main()
  89          {       
  90   1              IrInit();
  91   1              while(1)
  92   1              {       
  93   2                      DisplayData[0] = smgduan[IrValue[2]/16];
  94   2                      DisplayData[1] = smgduan[IrValue[2]%16];
  95   2                      DisplayData[2] = smgduan[16];
  96   2                  DigDisplay();               
  97   2              }               
  98   1      }
  99          
 100          /*******************************************************************************
 101          * 函数名         : ReadIr()
 102          * 函数功能                 : 读取红外数值的中断函数
 103          * 输入           : 无
 104          * 输出           : 无
 105          *******************************************************************************/
 106          
 107          void ReadIr() interrupt 0
 108          {
 109   1              u8 j,k;
 110   1              u16 err;
 111   1              Time=0;                                  
 112   1              delay(700);     //7ms
 113   1              if(IRIN==0)             //确认是否真的接收到正确的信号
 114   1              {        
 115   2                      
 116   2                      err=1000;                               //1000*10us=10ms,超过说明接收到错误的信号
 117   2                      /*当两个条件都为真是循环，如果有一个条件为假的时候跳出循环，免得程序出错的时
C51 COMPILER V9.01   MAIN                                                                  04/13/2021 19:35:08 PAGE 3   

 118   2                      侯，程序死在这里*/      
 119   2                      while((IRIN==0)&&(err>0))       //等待前面9ms的低电平过去               
 120   2                      {                       
 121   3                              delay(1);
 122   3                              err--;
 123   3                      } 
 124   2                      if(IRIN==1)                     //如果正确等到9ms低电平
 125   2                      {
 126   3                              err=500;
 127   3                              while((IRIN==1)&&(err>0))                //等待4.5ms的起始高电平过去
 128   3                              {
 129   4                                      delay(1);
 130   4                                      err--;
 131   4                              }
 132   3                              for(k=0;k<4;k++)                //共有4组数据
 133   3                              {                               
 134   4                                      for(j=0;j<8;j++)        //接收一组数据
 135   4                                      {
 136   5      
 137   5                                              err=60;         
 138   5                                              while((IRIN==0)&&(err>0))//等待信号前面的560us低电平过去
 139   5                                              {
 140   6                                                      delay(1);
 141   6                                                      err--;
 142   6                                              }
 143   5                                              err=500;
 144   5                                              while((IRIN==1)&&(err>0))        //计算高电平的时间长度。
 145   5                                              {
 146   6                                                      delay(10);       //0.1ms
 147   6                                                      Time++;
 148   6                                                      err--;
 149   6                                                      if(Time>30)
 150   6                                                      {
 151   7                                                              return;
 152   7                                                      }
 153   6                                              }
 154   5                                              IrValue[k]>>=1;  //k表示第几组数据
 155   5                                              if(Time>=8)                     //如果高电平出现大于565us，那么是1
 156   5                                              {
 157   6                                                      IrValue[k]|=0x80;
 158   6                                              }
 159   5                                              Time=0;         //用完时间要重新赋值                                                    
 160   5                                      }
 161   4                              }
 162   3                      }
 163   2                      // 校验数据正确
 164   2                      if(IrValue[2]!=~IrValue[3])
 165   2                      {
 166   3                              return;
 167   3                      }
 168   2              }                       
 169   1      }
 170          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    342    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15       1
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.01   MAIN                                                                  04/13/2021 19:35:08 PAGE 4   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
